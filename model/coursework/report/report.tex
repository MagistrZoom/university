\input{header.tex}
\input{hyperref.tex}
\usepackage{graphicx}
\usepackage{adjustbox}
\usepackage{multirow}

\def \labtype {Курсовая}
\def \labsubj {Моделирование}
\def \labauthor {Айтуганов Д. А. \\ Чебыкин И. Б.}
\def \labgroup {P3301}
\def \labinsp {Муравьева-Витковская Л. А.}
\def \labname{Творческая работа: Моделирование многопроцессорного планировщика задач}
\isonefalse
\isnumfalse
\isnametrue

\input{colored_code.tex}
\lstset{
	caption=\lstname,
	basicstyle=\ttfamily\selectfont\scriptsize
}
\begin{document}
\input{title.tex}
\tableofcontents
\newpage
\section{Цель работы}
Комплексное исследование характеристик функционирования дискретных систем,
моделируемых в виде разомкнутой системы массового обслуживания с использованием
имитационных свойств и аналитических методов и изучение свойств и
закономерностей, присущих процессам, протекающим в них.
\section{Этап 1. Выбор объекта исследования и описание концептуальной модели}
\subsection{Описание объекта исследования}
В качестве объекта исследования был выбран планировщик задач современных
операционных систем, работающий в системе с симметричной многопроцессорностью.
(SMP)
Алгоритм работы планировщика состоит в следующем:
\begin{itemize}
\item Процесс отрабатывает данный ему квант времени, затем либо завершается,
либо возвращается в очередь.
\item Периодически проверяется загрузка процессора, и, в случае
дисбаланса задачи из очереди перемещаются в менее загруженный процессор.
\item Процессы с меньшим приоритетом могут быть вытеснены
\end{itemize}
\begin{figure}[h]
\centering
\includegraphics[resolution=96]{img/smp.png}
\caption{Схема многопроцессорной системы}
\end{figure}

В рамках курсовой работы будет производиться исследование функционирования
системы, состоящей из данного числа процессоров, постоянно принимающих задачи.
\begin{figure}[h]
\centering
\includegraphics[resolution=96]{img/sched_scheme.png}
\caption{Схема исследуемой системы}
\end{figure}

Задача курсовой работы состоит в исследовании данной системы при данных параметрах
процессоров и определения на основе параметров лучшей конфигурацию системы.

\subsection{Разработка концептуальной модели}
В рамках исследования будут использоваться следующие предположения и допущения:
\begin{enumerate}
\item Задачи поступают и уходят из очереди мгновенно.
\item Очередь имеет ограниченный размер, дисциплина обслуживания: roundrobin.
\item Задачи делятся на два класса приоритетов, основанных на абсолютных
приоритетах, во время выполнения процесса, его приоритет уменьшается с каждым
тактом.
\item Дисциплина прерывания -- прерванная задача возвращается в очередь.
\item Задачи имеют два состояния: выполнение на процессоре, готовность.
\end{enumerate}
\begin{figure}[h]
\centering
\includegraphics[resolution=96]{img/sched_model.png}
\caption{Модель исследуемой системы}
\end{figure}

На вход поступают задачи, которые тут же попадают в свободные очереди для
процессоров. Процессор выделяет определенный квант на процесс, по истечении
которого процесс либо завершается, либо направляется в очередь того, процесса,
который меньше всего нагружен.

\section{Имитационная модель}
\subsubsection{Результаты имитационного моделирования}
За параметр варьирования было решено взять время между поступлениями процессов,
а также размер кванта.
Были проведены замеры для интервалов между поступлениями процессов для 100 мс,
200 мс, 300 мс.
При изменении размера кванта интервал был задан 100 мс.

\subsubsection{Anylogic}
\begin{figure}[h]
\centering
\includegraphics[resolution=96]{img/anylogic_model.png}
\caption{Модель Anylogic}
\end{figure}
\newpage
\subsubsection{GPSS}
\lstinputlisting{src/smo.gps.txt}
\subsubsection{Результаты Anylogic}

\begin{tabular}{|c|c|c|c|c|c|c|}
\hline
Время между поступлениями & Длина очереди & Загрузка прибора 1 & Загрузка прибора 2 \\ \hline
100 & 898,935 & 0,614 & 0,609 \\ \hline
 & 892,422 & 0,613 & 0,611 \\ \hline
 & 892,987 & 0,613 & 0,611 \\ \hline
 & 888,446 & 0,613 & 0,611 \\ \hline
200 & 4,871 & 0,497 & 0,51 \\ \hline
 & 4,875 & 0,492 & 0,497  \\ \hline
 & 4,755 & 0,492 & 0,495 \\ \hline
 & 4,896 & 0,498 & 0,501  \\ \hline
300 & 0,944 & 0,341 & 0,338  \\ \hline
 & 0,953 & 0,34 & 0,339 \\ \hline
 & 0,946 & 0,34 & 0,339 \\ \hline
 & 0,954 & 0,34 & 0,339  \\ \hline
\end{tabular}
\\

\begin{tabular}{|c|c|c|c|}
\hline
Размер кванта & Длина очереди & Загрузка прибора 1 & Загрузка прибора 2\\ \hline
100  & 879,948 & 0,612 & 0,611 \\ \hline
 & 892,422 & 0,611 & 0,61 \\ \hline
 & 892,987 & 0,611 & 0,61 \\ \hline
 & 888,446 & 0,611 & 0,61 \\ \hline
50 & 2,113 & 0,511 & 0,498 \\ \hline
 & 2,159 & 0,509 & 0,495 \\ \hline
 & 2,16 & 0,51 & 0,496 \\ \hline
 & 2,172 & 0,52 & 0,497 \\ \hline
10 & 0,029 & 0,108 & 0,109 \\ \hline
 & 0,028 & 0,107 & 0,108 \\ \hline
 & 0,03 & 0,108 & 0,109 \\ \hline
 & 0,029 & 0,108 & 0,109 \\ \hline

\end{tabular}

\subsubsection{Результаты GPSS}

\begin{tabular}{|c|c|c|c|}
\hline
Время между поступлениями & Длина очереди  & Загрузка прибора 1 & Загрузка прибора 2 \\ \hline
100 & 909,829 & 0,657 & 0,657 \\ \hline
 & 913,914 & 0,578 & 0,578 \\ \hline
 & 917,51 & 0,562 & 0,562 \\ \hline
 & 920,854 & 0,556 & 0,556 \\ \hline
200 & 17,305 & 0,514 & 0,514 \\ \hline
 & 16,244 & 0,513 & 0,513 \\ \hline
 & 17,135 & 0,514 & 0,514 \\ \hline
 & 16,984 & 0,513 & 0,513 \\ \hline
300 & 0,967 & 0,337 & 0,337 \\ \hline
 & 0,949 & 0,332 & 0,332 \\ \hline
 & 0,937 & 0,335 & 0,335 \\ \hline
 & 0,948 & 0,336 & 0,336 \\ \hline
\end{tabular}

\begin{tabular}{|c|c|c|c|}
\hline
Размер кванта & Длина очереди & Загрузка прибора 1 & Загрузка прибора 2 \\ \hline
100 & 909,829 & 0,657 & 0,657 \\ \hline
 & 913,914 & 0,596 & 0,588 \\ \hline
 & 917,51 & 0,597 & 0,597 \\ \hline
 & 920,854 & 0,554 & 0,554 \\ \hline
50 & 21,133 & 0,511 & 0,511 \\ \hline
 & 18,514 & 0,513 & 0,513 \\ \hline
 & 19,641 & 0,512 & 0,512 \\ \hline
 & 17,485 & 0,511 & 0,511 \\ \hline
10 & 0,014 & 0,099 & 0,099 \\ \hline
 & 0,012 & 0,101 & 0,101 \\ \hline
 & 0,012 & 0,102 & 0,102 \\ \hline
 & 0,013 & 0,1 & 0,1 \\ \hline
\end{tabular}
\subsection{Графические представления}
\begin{figure}
\centering
\includegraphics[resolution=96]{img/intensity.png}
\caption{Варьирование времени между процессами}
\end{figure}

\begin{figure}
\centering
\includegraphics[resolution=96]{img/quantum.png}
\caption{Варьирование кванта} \end{figure}

\subsubsection{Доверительные интервалы}

\textbf{Anylogic}

\begin{adjustbox}{max width=\textwidth}
\begin{tabular}{|c|c|c|c|}
\hline
Время между поступлениями & Длина очереди & Загрузка прибора 1 & Загрузка прибора 2 \\ \hline
100 & 19,76092 & 0,00143 & 0,00287 \\ \hline
200 & 0,59952 & 0,00717 & 0,02023 \\ \hline
300 & 0,01174 & 0,00143 & 0,00143 \\ \hline
\end{tabular}
\end{adjustbox}
\newline
\vspace*{1 cm}
\newline

\textbf{Anylogic}

\begin{adjustbox}{max width=\textwidth}
\begin{tabular}{|c|c|c|c|}
\hline
Размер кванта & Длина очереди & Загрузка прибора 1 & Загрузка прибора 2 \\ \hline
100 & 18,30905 & 0,00143 & 0,00143 \\ \hline
50 & 0,06670 & 0,00248 & 0,00379 \\ \hline
10 & 0,00248 & 0,00143 & 0,00143 \\ \hline
\end{tabular}
\end{adjustbox}
\newline
\vspace*{1 cm}
\newline

\textbf{GPSS}

\begin{adjustbox}{max width=\textwidth}
\begin{tabular}{|c|c|c|c|}
\hline
Время между поступлениями & Длина очереди & Загрузка прибора 1 & Загрузка прибора 2 \\ \hline
100 & 9,54677 & 0,12635 & 0,12635 \\ \hline
200 & 1,41563 & 0,00143 & 0,00143 \\ \hline
300 & 0,03751 & 0,00625 & 0,00625 \\ \hline
\end{tabular}
\end{adjustbox}
\newline
\vspace*{1 cm}
\newline

\textbf{GPSS}

\begin{adjustbox}{max width=\textwidth}
\begin{tabular}{|c|c|c|c|}
\hline
Размер кванта & Длина очереди & Загрузка прибора 1 & Загрузка прибора 2 \\ \hline
100 & 9,54677 & 0,08678 & 0,09318 \\ \hline
50 & 3,26349 & 0,00248 & 0,00248 \\ \hline
10 & 0,00287 & 0,00379 & 0,00379 \\ \hline
\end{tabular}
\end{adjustbox}

\subsubsection{Выводы}
Результаты моделирования в разных программных продуктах показали хоть и различные,
но близкие, с учетом доверительного интервала, к друг другу результаты.
Вероятно, различия обусловлены разными реализациями генераторов случайных чисел
в каждой из программ.

По результатам моделирования видно, что при уменьшении времени между послуплениями
процессов, очередь начинает постоянно заполняться, так как помимо быстро приходящих
новых процессов, в очередь возвращаются процессы, отработавшие свой квант.

Для устранения этой проблемы можно как увеличивать время между поступлениями
процессов, так и изменять размер кванта, который выделяется на процесс. Однако,
как следует из результатов, при слишком маленьком кванте загрузка очень сильно
снижается, что приведет к слишком большим затратам на смену контекста в реальной модели.

Время между поступлениями процессов равное 200 мс можно назвать критическим,
т.к. при его уменьшении наблюдается постоянное увеличение размера очереди.

Подобрав наиболее удачные параметры кванта и времени поступления, можно сказать,
что данная система будет вести себя стабильно и при больших количествах процессов,
сохраняя высокую загрузку и малую длину очереди.


\newpage
\section{Аналитическая модель}
С помощью заданных допущений была составлена СМО с неоднородным потоком заявок,
ввиду того, что нагрузку нельзя свести к однородной из-за наличия приоритетов.

\subsection{Характеристики модели}

\begin{adjustbox}{max width=\textwidth}
\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\hline
\multicolumn{14}{|c|}{Характеристики обслуживания класса заявок в СМО} \\ \hline
& & \multicolumn{3}{|c|}{Ср. время ожидания} & \multicolumn{3}{|c|}{Ср. время пребывания} & \multicolumn{3}{|c|}{Ср. длина в очереди} & \multicolumn{3}{|c|}{Ср. число заявок в системе} \\ \hline
Класс & Загрузка & БП & ОП & АП & БП & ОП & АП & БП & ОП & АП & БП & ОП & АП \\ \hline
1 & 0,05 & 0,001 & 0,001 & 0,0003 & 0,301 & 0,301 & 0,3003 & 0,001 & 0,001 & 0,0003 & 0,101 & 0,101 & 0,1003 \\ \hline
2 & 0,05 & 0,001 & 0,0011 & 0,0018 & 0,301 & 0,3011 & 0,3018 & 0,001 & 0,0011 & 0,0018 & 0,101 & 0,1011 & 0,1018 \\ \hline
\end{tabular}
\end{adjustbox}
\\

\begin{adjustbox}{max width=\textwidth}
\begin{tabular}{|c|c|c|c|c|c|c|c|c|}
\hline
\multicolumn{9}{|c|}{Характеристики обслуживания объединенного потока заявок в СМО} \\ \hline
l & R & b & ДО & Ср. время ожидания & Ср. время пребывания & Ср. длина в очереди & Ср. число заявок в системе & Константа ВО \\ \hline
2 & 0,1 & 0,1 & БП & 0,001  & 0,301 & 0,002 & 0,202 & 0,00010 \\ \hline
 &  &  & ОП & 0,001 & 0,301 & 0,002 & 0,202 & 0,00011 \\ \hline
 &  &  & АП & 0,001 & 0,301 & 0,002 & 0,202 & 0,00011 \\ \hline

\end{tabular}
\end{adjustbox}

\subsubsection{Графики варьирования длительности обслуживания}

\begin{figure}[h]
\centering
\includegraphics[resolution=200]{img/bp.png}
\caption{Без приоритетов}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[resolution=200]{img/op.png}
\caption{Относительные приоритеты}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[resolution=200]{img/ap.png}
\caption{Абсолютные приоритеты}
\end{figure}

\subsubsection{Зависимости характеристик от приоритетов и от суммарной загрузки}
\begin{figure}[h]
\centering
\includegraphics[resolution=128]{img/bp_op_ap_load.png}
\caption{БП, ОП, АП, от суммарной загрузки}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[resolution=128]{img/bp_op_ap_prio.png}
\caption{БП, ОП, АП, от приоритета}
\end{figure}

Исходя из графиков видно, что число заявок увеличивается для более приоритетного
класса 2, когда как для класса 1 оно уменьшается.
\end{document}
